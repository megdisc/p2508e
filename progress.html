<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="robots" content="noindex, nofollow">
    <title>進捗記録</title> 
    
    <link rel="stylesheet" href="colors.css">
    <link rel="stylesheet" href="style.css">
    
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200">

    </head>
<body data-page-key="PROGRESS">

    <div class="app-layout">
        
        <aside class="sidebar">
            <div class="logo">p2508e</div>
            <nav class="global-nav"></nav>
            

            <div class="sidebar-footer">
                <div class="user-name">山田太郎</div>
                <div class="user-role">管理者</div>
                <div class="sidebar-logout">
                    <a href="#">ログアウト</a>
                </div>
            </div>

        </aside>

        <main class="main-content">
            <h1></h1> 
            <div class="controls">
                <div class="view-toggle" role="radiogroup" aria-label="表示切替">
                    <input type="radio" id="viewUser" name="viewType" value="user" checked>
                    <label for="viewUser">利用者別</label>
                    <input type="radio" id="viewProject" name="viewType" value="project">
                    <label for="viewProject">案件別</label>
                    <input type="radio" id="viewTask" name="viewType" value="task">
                    <label for="viewTask">タスク別</label>
                </div>
                <div class="date-filter">
                    <button class="date-nav-btn" title="前の月">◀</button>
                    <label for="progressMonth">対象月:</label>
                    <input type="month" id="progressMonth" value="2025-11">
                    <button class="date-nav-btn" title="次の月">▶</button>
                </div>
            </div>
            
            <div id="progress-card-container" class="card-list-container">
                </div>
            </main>
    </div>

    <script>
        // --- モックデータ定義 (進捗記録用) ---
        // (projects.html のデータと attendance.html のデータをマージしたイメージ)

        const mockProgressData = [
            // 日付, 利用者ID, 案件ID, タスク名, 実績数量, 実績時間
            { date: '2025-11-04', userId: 'U-001', userName: '鈴木 花子', projectId: 'P-001', taskName: '型抜き', quantity: 200, hours: 3.0 },
            { date: '2025-11-04', userId: 'U-001', userName: '鈴木 花子', projectId: 'P-001', taskName: '組み立て', quantity: 50, hours: 2.0 },
            { date: '2025-11-04', userId: 'U-002', userName: '山田 太郎', projectId: 'P-002', taskName: '汚れ確認', quantity: 500, hours: 4.5 },
            { date: '2025-11-05', userId: 'U-001', userName: '鈴木 花子', projectId: 'P-001', taskName: '組み立て', quantity: 150, hours: 5.0 },
            { date: '2025-11-05', userId: 'U-003', userName: '佐藤 一郎', projectId: 'P-002', taskName: '封入', quantity: 300, hours: 4.0 },
            { date: '2025-11-07', userId: 'U-002', userName: '山田 太郎', projectId: 'P-001', taskName: '検品・梱包', quantity: 100, hours: 2.5 },
            { date: '2025-11-07', userId: 'U-003', userName: '佐藤 一郎', projectId: 'P-002', taskName: '封入', quantity: 200, hours: 3.0 }
        ];

        // 案件マスタ (projects.html より)
        const mockProjectMaster = {
            'P-001': { name: '箱折り', tasks: ['型抜き', '組み立て', '検品・梱包'] },
            'P-002': { name: 'DM検品・封入', tasks: ['汚れ確認', '封入'] },
            'P-004': { name: '自主製品 (クッキー) 製造', tasks: ['生地準備', '焼成・梱包'] }
        };

        // 利用者マスタ (attendance.html より)
        const mockUserMaster = {
            'U-001': { name: '鈴木 花子' },
            'U-002': { name: '山田 太郎' },
            'U-003': { name: '佐藤 一郎' }
        };

        // --- DOM要素の取得 ---
        const viewToggles = document.querySelectorAll('input[name="viewType"]');
        const cardContainer = document.getElementById('progress-card-container');

        // --- イベントリスナーの設定 ---
        viewToggles.forEach(toggle => {
            toggle.addEventListener('change', (e) => {
                renderProgressCards(e.target.value);
            });
        });

        // --- レンダリング関数 ---

        /**
         * 共通: 進捗入力行 (サブコンポーネント)
         * @param {string} mainLabel - メインラベル (タスク名、利用者名など)
         * @param {string} subLabel - サブラベル (案件名、担当者名など)
         * @param {number} quantity - 現在の数量
         * @param {number} hours - 現在の時間
         */
        function createProgressInputRow(mainLabel, subLabel, quantity = 0, hours = 0) {
            return `
                <div class="progress-input-row">
                    <div class="progress-input-label">
                        <span class="label-main">${mainLabel}</span>
                        <span class="label-sub">${subLabel}</span>
                    </div>
                    <div class="progress-input-fields">
                        <label for="qty_${mainLabel}">数量:</label>
                        <input type="number" id="qty_${mainLabel}" value="${quantity}">
                        <label for="hrs_${mainLabel}">時間:</label>
                        <input type="number" id="hrs_${mainLabel}" value="${hours}" step="0.5">
                    </div>
                </div>
            `;
        }


        /**
         * メイン: カード描画 (ビュー切替)
         * @param {string} viewType - 'user', 'project', 'task'
         */
        function renderProgressCards(viewType = 'user') {
            
            let html = '';

            if (viewType === 'user') {
                // --- 利用者別ビュー ---
                Object.values(mockUserMaster).forEach(user => {
                    // (デモのため、全案件の全タスクを入力欄として表示)
                    let inputRowsHtml = '';
                    Object.entries(mockProjectMaster).forEach(([projectId, project]) => {
                        project.tasks.forEach(taskName => {
                             // TODO: 本来は当月の実績値 (mockProgressData) から quantity, hours を取得する
                            inputRowsHtml += createProgressInputRow(taskName, project.name, 0, 0);
                        });
                    });

                    html += `
                        <div class="progress-card">
                            <div class="progress-card-header">
                                <h2 class="progress-card-title">${user.name}</h2>
                            </div>
                            <div class="progress-card-body">
                                ${inputRowsHtml}
                            </div>
                        </div>
                    `;
                });
            } 
            
            else if (viewType === 'project') {
                // --- 案件別ビュー ---
                Object.entries(mockProjectMaster).forEach(([projectId, project]) => {
                    let inputRowsHtml = '';
                    project.tasks.forEach(taskName => {
                        // (デモのため、全利用者を対象に入力欄を表示)
                         Object.values(mockUserMaster).forEach(user => {
                            // TODO: 本来は当月の実績値 (mockProgressData) から quantity, hours を取得する
                            inputRowsHtml += createProgressInputRow(user.name, taskName, 0, 0);
                        });
                    });
                    
                    html += `
                        <div class="progress-card">
                            <div class="progress-card-header">
                                <h2 class="progress-card-title">${project.name}</h2>
                                <p class="progress-card-subtitle">ID: ${projectId}</p>
                            </div>
                            <div class="progress-card-body">
                                ${inputRowsHtml}
                            </div>
                        </div>
                    `;
                });
            } 
            
            else if (viewType === 'task') {
                // --- タスク別ビュー ---
                // (全案件からタスクをユニークに集計)
                const allTasks = new Map();
                Object.entries(mockProjectMaster).forEach(([projectId, project]) => {
                    project.tasks.forEach(taskName => {
                        if (!allTasks.has(taskName)) {
                            allTasks.set(taskName, []);
                        }
                        allTasks.get(taskName).push(project.name);
                    });
                });

                allTasks.forEach((projectNames, taskName) => {
                     let inputRowsHtml = '';
                     // (デモのため、全利用者を対象に入力欄を表示)
                     Object.values(mockUserMaster).forEach(user => {
                        // TODO: 本来は当月の実績値 (mockProgressData) から quantity, hours を取得する
                        inputRowsHtml += createProgressInputRow(user.name, `担当案件: ${projectNames.join(', ')}`, 0, 0);
                     });

                    html += `
                        <div class="progress-card">
                            <div class="progress-card-header">
                                <h2 class="progress-card-title">${taskName}</h2>
                                <p class="progress-card-subtitle">関連案件: ${projectNames.join(', ')}</p>
                            </div>
                            <div class="progress-card-body">
                                ${inputRowsHtml}
                            </div>
                        </div>
                    `;
                });
            }

            cardContainer.innerHTML = html;
        }

        // --- 初期表示 ---
        renderProgressCards('user'); // デフォルトは利用者別
    </script>
        <script src="constants.js"></script>
    <script src="layout.js" defer></script>
</body>
</html>